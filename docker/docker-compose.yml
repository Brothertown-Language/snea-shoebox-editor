services:
  streamlit:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    hostname: streamlit
    ports:
      - "8501:8501"
    volumes:
      - ..:/app
    environment:
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
    command: uv run streamlit run src/frontend/app.py

  tester:
    build:
      context: ..
      dockerfile: docker/Dockerfile.test
    volumes:
      - ..:/app
      - tester_venv:/app/.venv
      - playwright_browsers:/ms-playwright
    environment:
      - PLAYWRIGHT_BROWSERS_PATH=/ms-playwright
    depends_on:
      streamlit:
        condition: service_started

  evaluator:
    build:
      context: ..
      dockerfile: docker/Dockerfile.eval
      args:
        USER_ID: "${USER_ID}"
        GROUP_ID: "${GROUP_ID}"
        USER_NAME: "${USER_NAME}"
    volumes:
      - ../docker.data:/app/outputs
      - ../docker.app:/app/docker.app
      - ../docker.cache:/home/${USER_NAME}/.cache
    environment:
      - TZ=EST5EDT
    user: "${USER_ID}:${GROUP_ID}"

networks:
  default:
    name: snea-default

volumes:
  tester_venv:
  playwright_browsers:
  eval_data:
